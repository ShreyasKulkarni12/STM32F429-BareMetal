
#include "stm32f429xx.h"

void def_gpio(){
RCC->AHB1ENR |= ((1<<0) | (1<<6)); 		//Enabling clock for GPIOA
GPIOA->MODER |= (1<<1); 			//SET IN ALTERNATE FXN MODE
GPIOA->AFR[0] |= (1<<0); 			//SET AFRL REGISTER PA0 IN TIM2_CH1
GPIOG->MODER |= (1<<28);			//(PG14)Red-LED set to output mode
}
void def_timer(){
RCC->APB1ENR |= 1<<0; 				//ENABLE Timer2 peripheral
TIM2->CCMR1 = 0x0060; 				//TIM2 IN Pwm-1 mode (HIGH till TIM_CNT<TIM_CCR1)
TIM2->PSC = 16000-1; 				//prescaler value = 16000(if counted 0)
TIM2->ARR = 1000-1; 				//Autoreload value = 1000(if counted 0)
TIM2->CCR1 = 500; 				//Value=500 in the Compare register
TIM2->CCER |= (1<<0); 				//Compare enable for channel 1
TIM2->CR1 |= TIM_CR1_CEN; 			//counter enable
}

int main(){
	def_gpio();
	def_timer();
	while(1){
		if (TIM2->SR & TIM_SR_UIF){ 			//PG14 LED blink
			GPIOG->ODR ^= 1<<14; 			//Toggling PG14 RED LED
			TIM2->SR &= ~(TIM_SR_UIF); 		//Clearing Update interrupt flag
		}
	}
}
//pwm signal should come on the PortA pin = "0", connect the oscilloscope to PA0 and dont forget to connect the ground :)
